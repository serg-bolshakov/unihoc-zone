<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Всё для флорбола. Наборы клюшек, мячи, флорбольные ворота от ведущего мирового производителя." />
    <meta name="keywords" content="Базовый набор для флорбола. Флорбольные клюшки, мячи, борта, ворота. Для вратарей." />
    <meta name="robots" content="INDEX,FOLLOW" />
    <link type="image/png" sizes="16x16" rel="icon" href="icon/favicon-16x16.png">
    <link type="image/png" sizes="32x32" rel="icon" href="icons/favicon-32x32.png">
    <link type="image/png" sizes="96x96" rel="icon" href="icons/favicon-96x96.png">
    <link type="image/png" sizes="120x120" rel="icon" href="icons/favicon-120x120.png">
    <link type="image/png" sizes="256x256" rel="icon" href="icons/favicon-256x256.png"
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="styles/style.css" />
    <link rel="stylesheet" href="styles/main.css" />
    <link rel="stylesheet" href="styles/products.css"> 
    <title>UnihocZoneRussia. Флорбол. Базовая коллекция</title>
</head>

<body>
    <container class="container-products">
        <?php require_once "layout/header.php"; ?>    
        <section class="content-products">
            <div class="products-type">
                <img
                    src="images/main/basic-collection.jpg"
                    alt="basic-collection_banner"
                />
                <div class="products-item product-title">
                    <h1>Базовый набор и оборудование для флорбола</h1>
                </div>
            </div>  
        </section>
                
                <section class="nav-bar">
                    <ul class="breadcrumb">
                        <li><a href="/">Главная</a></li>
                        <li><a href="products.php">Каталог</a></li>
                        <li><a href="sticks.php">Клюшки</a></li>
                        <li><a href="blades.php">Крюки</a></li>
                        <li>Базовый ассортимент</li>
                    </ul>
                </section>
                <!--Делаем меню типа "Аккордеон"-->
                <aside class="menu-products">
                <div class="category-description">
                    <p>Базовая коллекция от лидера мирового производства флорбольной экипировки UNIHOC создана, чтобы способствовать распространению этого фантастического вида спорта по всему миру. Флорбол с каждым годом становится все более и более узнаваемым и распространенным, и чтобы иметь возможность быстро начать играть в флорбол, мы представляем ряд продуктов, идеально подходящих для этой цели. Все, от ворот, мячей и моделей клюшек начального уровня, доступно с несколькими вариантами на выбор.</p>
                </div>
                    <button class="accordion">КЛЮШКИ</button>
                        <div class="panel">
                            <p><a href="sticks.php">Смотреть все</a></p>
                            <p><a href="">EVOLAB</a></p>
                            <p><a href="">EVOLAB</a></p>
                            <p><a href="">CARBSKIN</a></p>
                            <p><a href="">CARBSKIN CURVE</a></p>
                            <p>EVOLAB</p>
                            <p>CARBSKIN</p>
                            <p>CARBSKIN CURVE</p>
                            <p>SUPERSKIN</p>
                            <p>SIGNATURE SERIES</p>
                            <p>ECO</p>
                            <p>SUPERSHAPE</p>
                            <p>TITAN SERIES</p>
                            <p>OVAL SERIES</p>
                            <p>COMPOSITE</p>
                            <p>COMPOSITE YOUNGSTER</p>
                            <p>PLAYER</p>
                            <p>ZORRO</p>
                        </div>
                    
                    <button class="accordion">КРЮКИ</button>
                        <div class="panel">
                            <p><a href="">Смотреть все</a></p>
                            <p><a href="">UNILITE</a></p>
                            <p><a href="">ICONIC</a></p>
                            <p><a href="">EPIC</a></p>  
                            <p><a href="">SONIC</a></p>
                            <p><a href="">UNITY</a></p>
                            <p><a href="">CAVITY Z</a></p> 
                            <p><a href="">EVO 3 HOOK</a></p>
                            <p><a href="">HARDER</a></p>
                            <p><a href="">HYPER</a></p>
                            <p><a href="">MAKER</a></p>
                            <p><a href="">MONSTR</a></p>
                            <p><a href="">ZUPER</a></p>      
                        </div>

                    <button class="accordion">ОБМОТКИ</button>
                    <div class="panel">
                        <p><a href="">Смотреть все</a></p>
                        <p>ELITE</p>
                        <p>PRO</p>
                        <p>TOP</p>
                    </div>
                    
                    <button class="accordion">ОБУВЬ</button>
                    <div class="panel">
                        <p><a href="">Смотреть все</a></p>
                        <p>ВРАТАРСКАЯ</p>
                        <p>ДЛЯ ПОЛЕВЫХ ИГРОКОВ</p>
                    </div>

                    <button class="accordion">ВРАТАРСКАЯ ЭКИПИРОВКА</button>
                    <div class="panel">
                        <p><a href="">Смотреть все</a></p>
                        <p>ШЛЕМЫ</p>
                        <p>СВИТЕРЫ</p>
                        <p>ШТАНЫ</p>
                    </div>

                    <button class="accordion">ОДЕЖДА</button>
                    <div class="panel">
                        <p><a href="">Смотреть все</a></p>
                        <p>ИГРОВАЯ ФОРМА</p>
                        <p>ТРЕНИРОВОЧНАЯ</p>
                        <p>ПОВСЕДНЕВНАЯ</p>
                    </div>

                    <button class="accordion">СУМКИ И ЧЕХЛЫ</button>
                    <div class="panel">
                        <p><a href="">Смотреть все</a></p>
                        <p>ЧЕХЛЫ ДЛЯ КЛЮШЕК</p>
                        <p>ВРАТАРСКИЕ БАУЛЫ</p>
                        <p>СПОРТИВНЫЕ СУМКИ</p>
                    </div>

                    <button class="accordion">АКСЕССУАРЫ</button>
                    <div class="panel">
                        <p><a href="">Смотреть все</a></p>
                        <p><a href="">ОЧКИ ФЛОРБОЛЬНЫЕ</a></p>
                        <p>НАПУЛЬСКИКИ И ПОВЯЗКИ</p>
                        <p>БУТЫЛКИ ДЛЯ ВОДЫ</p>
                        <p>РАЗНОЕ</p>
                    </div>

                    <button class="accordion">БАЗОВЫЙ АССОРТИМЕНТ</button>
                    <div class="panel">
                        <p>КЛЮШКИ</p>
                        <p>МЯЧИ</p>
                        <p>ОБОРУДОВАНИЕ</p>
                    </div>
                </aside>
                <?php
                require_once 'db.php';
                
                //номер страницы преобразовываем в команду, кот. будет доставать записи по 6 штук на страницу
                //$sql = "SELECT * FROM products LIMIT $fromNewPageStart, $notesOnPage"; 
                // стр 1 -> c 0, 6 записей, стр 2 -> с 6, 6 записей, стр 3 -> с 12, 6 записей...
                //выполняем запрос и результат кладём в переменную $result
                //$result=$connect->query($sql);
                
                $page = $_GET['page'] ?? 1;
                //проверяем, чтобы не ввели чего лишнего в адресную строну с номером страницы, чтобы скрипт не завис
                $page = filter_var($page, FILTER_VALIDATE_INT, array("options" =>
                         array('default' => 1, 'min_range' => 1, 'max_range' => 99  )));

                $notesOnPage = 6; //LIMIT количество товаров на странице начиная с 0 позиции, 6 товаров, далее с 6-й шесть товаров...
                $fromNewPageStart = ($page - 1) * $notesOnPage; 
                

                $sql = "SELECT * 
                        FROM products, categories, brands, properties, prod_prop, prices, images
                            WHERE products.category_id = categories.id AND products.brand_id = brands.id AND products.id = images.product_id
                            AND properties.category_id = categories.id AND prices.product_id = products.id
                            AND prod_prop.product_id = products.id AND prod_prop.property_id = properties.id AND images.img_showcase = true
                            AND prop_title LIKE 'series' AND prop_value LIKE 'basic_collection'
                            ORDER BY RAND()
                            LIMIT $notesOnPage OFFSET $fromNewPageStart
                  ";
                //выполняем запрос и результат кладём в переменную $result
                $result=$connect->query($sql);
                ?>    
                          
                <section class="assortiment-cards">
                    <div class="assortiment-card">
                    <?php while ($item = $result->fetch_object()):?> 
                        <div class="assortiment-card__block">
                            <img src="<?= $item->img_link?>" alt="<?= $item->category?> <?= $item->brand?> <?= $item->model ?> <?= $item->marka ?>">
                            <div class="assortiment-card_productName"><?= $item->title?> </div>
                            <div class="assortiment-card_productPrice">
                            
                            <?php
                              /* если не назначена акция (специальная цена, 
                              то полный блок цен не выводится, его пропускаем - 
                              выводится только актуальная цена (следующий блок)*/
                            ?>

                            <?php if ($item->price_special): ?> 
                                <p class="priceCurrentSale"><nobr><?= number_format($price= $item->price_special, 0,",", " " ); ?> <sup>&#8381;</sup></nobr></p>
                                <p class="priceBeforSale"><nobr><?= number_format($price= $item->price_regular, 0,",", " " ); ?> <sup>&#8381;</sup></nobr></p>
                                <p class="priceDiscountInPercentage"><nobr>- <?= $discount = ceil(100 - ($price= $item->price_special) / ($price= $item->price_regular) * 100); ?>&#37;</nobr></p>
                            <?php else: ?>
                                <p class="priceCurrent"><nobr><?= number_format($price= $item->price_regular, 0,",", " " ); ?> <sup>&#8381;</sup></nobr></p>
                            <?php endif; ?>
                            </div>
                        </div>
                    <?php endwhile; ?>
                    </div>
                </section>
                
                <section class="pagination-products">
                
                <?php
                //делаем новый запрос, который посчитает количество записей в БД
                              
                // $sql = "SELECT COUNT(category_id) as count FROM products
                //         "; 

                $sql = "SELECT COUNT(*) as count 
                        FROM products, categories, brands, properties, prod_prop, prices, images
                        WHERE products.category_id = categories.id AND products.brand_id = brands.id AND products.id = images.product_id
                        AND properties.category_id = categories.id AND products.id = prices.id AND prod_prop.product_id = products.id 
                        AND prod_prop.property_id = properties.id AND images.img_showcase = true
                        AND prop_value LIKE 'basic_collection'
                ";

                $result=$connect->query($sql);
                $count = $result->fetch_assoc() ['count']; //и в переменную $count запишем сразу число по ключу ['count'], а не массив
                //считаем количество страниц
                $pagesCount = ceil($count / $notesOnPage);
                             
                // проверяем для стрелочек влево, что мы на первой странице ... если на первой стрелки деактивируются, но остаются видимыми
                if ($page != 1){
                    $prev = $page - 1; //предыдущая страница
                    echo "<a href=\"?page=$prev\"><<</a> ";
                } else {
                    echo "<<  ";
                }
                //запускаем цикл для ссылок на страницы
                for ($i=1; $i <= $pagesCount; $i++) {
                    if ($page == $i) {
                        echo "<a href=\"?page=$i\" class=\"activeProduct\">$i</a> ";
                    } else echo "<a href=\"?page=$i\">$i</a> ";
                }
                
                if ($page != $pagesCount){
                    $next = $page + 1; //следующая страница
                    echo "<a href=\"?page=$next\">>></a> ";
                } else {
                    echo "  >>";
                }                
                ?>    
                
                </section>
                <?php require_once "layout/footer.php"; ?>